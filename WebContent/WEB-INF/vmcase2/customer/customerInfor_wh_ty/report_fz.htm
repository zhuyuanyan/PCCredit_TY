#parse ("common/iframe_page_header.htm")
#parse ("common/macro.htm")
<link rel="stylesheet" type="text/css" href="${uicasePath}/css/specialtab.css" />
<script src="${contextPath}/common/js/common/Date.js"></script>
<script src="${contextPath}/common/js/common/Stack.js"></script>
<script src="${contextPath}/common/js/common/Tokanizer.js"></script>
<script src="${contextPath}/common/js/common/Evaluator.js"></script>
<script type="text/javascript">
	var rules = [
			'B5=B6+B7+B8',
			'D5=D6+D7+D8',
			'B9=B10+B11+B12',
			'D9=D10+D11+D12',
			'B13=B14+B15+B16',
			'D13=D14+D15+D16',
			'B17=B18+B19+B20',
			'D17=D18+D19+D20',
			'B21=B22+B23+B24+B25+B26+B27',
			'D21=D22+D23+D24+D25+D26+D27',
			'B28=B29+B30+B31',
			'D28=D14+D17+D21',
			'D29=B32-D28',
			'B32=B4+B21+B28',
			'D32=D28+D29',
			'D33=D28/B32',
			
			'B4=B5+B9+B13+B17',
			'D4=D5+D9+D13',
			
			'B34=B4/D4',
			'D33=D28/B32',
			'D34=(B5+B9)/D4'
	            ]
	var exp = new Expression("");

	function Convert(strExp)
	{
	    if (strExp == null || strExp == undefined)
	    {
	        alert ("No expression is specified!");
	        return false;
	    }

	    exp.Expression(strExp);
	    return exp.Parse();
	}

	function Compute(strExp)
	{
	    exp.Expression(strExp);
	    var res = exp.Evaluate()+"";
	    if(res.indexOf(".")>=0){
	    	return new Number(parseFloat(res)).toFixed(2);
	    }
	    else{
	    	return res;
	    }
	}
</script>
<body class="whitebg">
  <div class="content_main">
    <div class="contentinner">
      <div class="place">
        <div class="title">客户维护信息>资负</div>
      </div>
        <div class="tabplace">
            <ul class="com-tab" >
            <li class="tab activeTab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_fz.page?appId=${appId}&urlType=${urlType}">资产负债表</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_sy.page?appId=${appId}&urlType=${urlType}">损益表</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_jl.page?appId=${appId}&urlType=${urlType}">现金流</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_jc.page?appId=${appId}&urlType=${urlType}">交叉检验表</a></li>
         </ul>
         </div>
      <form id="id_module_form">
         <div class="form-bd" id="formsId" style="margin-top: 0px;padding-top: 0px;">$!{tableContent}</div>
      </form>
      <div class="submit">
      #if(!$!lock)
      	<input type="button" class="current" id="id_count_button" value="计算" />
      	<input type="button" class="current" id="id_save_button" value="保存" />
      #end
      #if($!urlType==1)
        <input type="button" onclick="window.location.href='${contextPath}/intopieces/intopiecesquery/browse.page'" value="返回" />
      #else
      	<!-- <input type="button" onclick="window.location.href='${contextPath}/customer/customerInfor_wh_ty/browse.page'" value="返回" /> -->
      	<input type="button" onclick="window.location.href='${contextPath}/intopieces/intopiecesquery/browse.page'" value="返回" />
      #end
      </div>
    </div>
  </div>
  <script type="text/javascript">
	var layout = new FormsLayout("formsId");
	window.top.currentWindow.setLayout(layout);
	#set ($formName = "'#id_module_form'")
	#parse ("customer/customerInfor_wh_ty/customer_iframe_1_change_validation.js")
	
	$(document).ready(function() {		
		$("#id_save_button").click(function() {
			var b = new Base64(); 
			var content = {'content':b.encode($("#formsId").html())};
			var url = "${contextPath}/customer/customerInfor_wh_ty/change_report_fz.json?appId=${appId}";
			$.ajax({
				 url : url,
				 type : "post",
				 data:content,
				 success : function(data) {
					 if (data.success) {
						 topWin.Dialog.message("保存成功！");
						 window.location.reload();
					 }
					 else{
						 topWin.Dialog.message(data.message);
					 }
				 }
			 });
        });
		
		//计算
		$("#id_count_button").click(function() {
			for(index in rules){
				var rule = rules[index];
				var sum_name = rule.split("=")[0];
				var strExp = rule.split("=")[1];
				//将编码换成数值
				var code = "";
				var sb = "";
				for(var i = 0;i<strExp.length;i++){
					if("^,*,/,%,+,-,(,)".indexOf(strExp[i])<0){
						code += strExp[i];
					}
					else{
						if(code != ""){
							var reg= /^[A-Za-z]+$/;
							if(reg.test(code[0])){
								if($("td[name='"+code+"']").html() == '&nbsp;')
								{
									sb += "0";
								}
								else{
									sb += $("td[name='"+code+"']").html();
								}
							}else{
								sb += code;
							}
							code = "";
						}
						sb += strExp[i];
					}
				}
				if(code != ""){
					var reg= /^[A-Za-z]+$/;
					if(reg.test(code[0])){
						if($("td[name='"+code+"']").html() == '&nbsp;')
						{
							sb += "0";
						}
						else{
							sb += $("td[name='"+code+"']").html();
						}
					}else{
						sb += code;
					}
					code = "";
				}
				$("td[name='"+sum_name+"']").html(Compute(sb));
				exp.Reset();
			}
		});
	});
  </script>
   <script src="${contextPath}/js/customerInfor/customer_infor.js"></script>
  
</body>
#parse ("common/iframe_page_footer.htm")
