#parse ("common/iframe_page_header.htm")
#parse ("common/macro.htm")
<link rel="stylesheet" type="text/css" href="${uicasePath}/css/specialtab.css" />
<script src="${contextPath}/common/js/common/Date.js"></script>
<script src="${contextPath}/common/js/common/Stack.js"></script>
<script src="${contextPath}/common/js/common/Tokanizer.js"></script>
<script src="${contextPath}/common/js/common/Evaluator.js"></script>
<script type="text/javascript">
	var rules = [
				"G6=C6*C5+D6*D5+E6*E5","H6=G6/12",
				"G7=C7+D7+E7","H7=G7/12",
				"C8=C6-C7","D8=D6-D7","E8=E6-E7","F8=F6-F7","G8=G6-G7","H8=G8/12",
				"G9=C9+D9+E9","H9=G9/12",
				"G10=C10+D10+E10","H10=G10/12",
				"G11=C11+D11+E11","H11=G11/12",
				"G12=C12+D12+E12","H12=G12/12",
				"G13=C13+D13+E13","H13=G13/12",
				"G14=C14+D14+E14","H14=G14/12",
				"G15=C15+D15+E15","H15=G15/12",
				"G16=C16+D16+E16","H16=G16/12",
				"G17=C17+D17+E17","H17=G17/12",
				"G18=C18+D18+E18","H18=G18/12",
				"G19=C19+D19+E19","H19=G19/12",
				"G20=C20+D20+E20","H20=G20/12",
				"G21=C21+D21+E21","H21=G21/12",
				"G22=C22+D22+E22","H22=G22/12",
				"G23=C23+D23+E23","H23=G23/12"
				
				"C24=C9+C10+C11+C12+C13+C14+C15+C16+C17+C18+C19+C20+C21+C22+C23",
				"D24=D9+D10+D11+D12+D13+D14+D15+D16+D17+D18+D19+D20+D21+D22+D23",
				"E24=E9+E10+E11+E12+E13+E14+E15+E16+E17+E18+E19+E20+E21+E22+E23",
				"F24=F9+F10+F11+F12+F13+F14+F15+F16+F17+F18+F19+F20+F21+F22+F23",
				"G24=C24+D24+E24",
				"H24=G24/12",
				
				"G25=C25+D25+E25","H25=G25/12",
				
				"C26=C8-C24-C25",
				"D26=D8-D24-D25",
				"E26=E8-E24-E25",
				"F26=F8-F24-F25",	
				"G26=C26+D26+E26",
				"H26=G26/12",

				"G27=C27+D27+E27","H27=G27/12",
				"G28=C28+D28+E28","H28=G28/12",
				"G29=C29+D29+E29","H29=G29/12",
				"G30=C30+D30+E30","H30=G30/12",

				"C31=C26-C27-C28-C29+C30",
				"D31=D26-D27-D28-D29+D30",
				"E31=E26-E27-E28-E29+E30",
				"F31=F26-F27-F28-F29+F30",
				"G31=C31+D31+E31",
				"H31=G31/12"
	            ]
	var exp = new Expression("");

	function Convert(strExp)
	{
	    if (strExp == null || strExp == undefined)
	    {
	        alert ("No expression is specified!");
	        return false;
	    }

	    exp.Expression(strExp);
	    return exp.Parse();
	}

	function Compute(strExp)
	{
	    exp.Expression(strExp);
	    var res = exp.Evaluate()+"";
	    if(res.indexOf(".")>=0){
	    	return new Number(parseFloat(res)).toFixed(2);
	    }
	    else{
	    	return res;
	    }
	}
</script>
<body class="whitebg">
  <div class="content_main">
    <div class="contentinner">
      <div class="place">
        <div class="title">客户维护信息>利润简表</div>
      </div>
        <div class="tabplace">
            <ul class="com-tab" >
            <li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_jy.page?appId=${appId}&urlType=${urlType}">建议</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_jjbs.page?appId=${appId}&urlType=${urlType}">进件标识</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_jbzk.page?appId=${appId}&urlType=${urlType}">基本状况</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_jyzt.page?appId=${appId}&urlType=${urlType}">经营状态</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_sczt.page?appId=${appId}&urlType=${urlType}">生存状态</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_ddpz.page?appId=${appId}&urlType=${urlType}">道德品质</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_fz.page?appId=${appId}&urlType=${urlType}">资产负债</a></li>
			<li class="tab activeTab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_lrjb.page?appId=${appId}&urlType=${urlType}">利润简表</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_bzlrb.page?appId=${appId}&urlType=${urlType}">标准利润</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_xjllb.page?appId=${appId}&urlType=${urlType}">现金流</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_jc.page?appId=${appId}&urlType=${urlType}">交叉</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_dhd.page?appId=${appId}&urlType=${urlType}">点货单</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_gdzc.page?appId=${appId}&urlType=${urlType}">固资</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_yfys.page?appId=${appId}&urlType=${urlType}">应付预收</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_ysyf.page?appId=${appId}&urlType=${urlType}">应收预付</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_lsfx.page?appId=${appId}&urlType=${urlType}">流水</a></li>
         </ul>
         </div>
      <form id="id_module_form">
         <div class="form-bd" id="formsId" style="margin-top: 0px;padding-top: 0px;">$!{tableContent}</div>
      </form>
      <div class="submit">
      #if(!$!lock)
      	<input type="button" class="current" id="id_count_button" value="计算" />
      	<input type="button" class="current" id="id_save_button" value="保存" />
      #end
      #if($!urlType==1)
        <input type="button" onclick="window.location.href='${contextPath}/intopieces/intopiecesquery/browse.page'" value="返回" />
      #else
      	<input type="button" onclick="window.location.href='${contextPath}/customer/customerInfor_wh_ty/browse.page'" value="返回" />
      #end
      </div>
    </div>
  </div>
  <script type="text/javascript">
	var layout = new FormsLayout("formsId");
	window.top.currentWindow.setLayout(layout);
	#set ($formName = "'#id_module_form'")
	#parse ("customer/customerInfor_wh_ty/customer_iframe_1_change_validation.js")
	
	$(document).ready(function() {		
		$("#id_save_button").click(function() {
			var b = new Base64(); 
			var content = {'content':b.encode($("#formsId").html())};
			var url = "${contextPath}/customer/customerInfor_wh_ty/change_report_lrjb.json?appId=${appId}";
			$.ajax({
				 url : url,
				 type : "post",
				 data:content,
				 success : function(data) {
					 if (data.success) {
						 topWin.Dialog.message("保存成功！");
						 window.location.reload();
					 }
					 else{
						 topWin.Dialog.message(data.message);
					 }
				 }
			 });
        });
		
		//计算
		$("#id_count_button").click(function() {
			for(index in rules){
				var rule = rules[index];
				var sum_name = rule.split("=")[0];
				var strExp = rule.split("=")[1];
				//将编码换成数值
				var code = "";
				var sb = "";
				for(var i = 0;i<strExp.length;i++){
					if("^,*,/,%,+,-,(,)".indexOf(strExp[i])<0){
						code += strExp[i];
					}
					else{
						if(code != ""){
							var reg= /^[A-Za-z]+$/;
							if(reg.test(code[0])){
								if($("td[name='"+code+"']").html() == '&nbsp;')
								{
									sb += "0";
								}
								else{
									sb += $("td[name='"+code+"']").html();
								}
							}else{
								sb += code;
							}
							code = "";
						}
						sb += strExp[i];
					}
				}
				if(code != ""){
					var reg= /^[A-Za-z]+$/;
					if(reg.test(code[0])){
						if($("td[name='"+code+"']").html() == '&nbsp;')
						{
							sb += "0";
						}
						else{
							sb += $("td[name='"+code+"']").html();
						}
					}else{
						sb += code;
					}
					code = "";
				}
				$("td[name='"+sum_name+"']").html(Compute(sb));
				exp.Reset();
			}
		});
	});
  </script>
   <script src="${contextPath}/js/customerInfor/customer_infor.js"></script>
  
</body>
#parse ("common/iframe_page_footer.htm")
