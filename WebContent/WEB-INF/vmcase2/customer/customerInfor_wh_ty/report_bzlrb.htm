#parse ("common/iframe_page_header.htm")
#parse ("common/macro.htm")
<link rel="stylesheet" type="text/css" href="${uicasePath}/css/specialtab.css" />
<script src="${contextPath}/common/js/common/Date.js"></script>
<script src="${contextPath}/common/js/common/Stack.js"></script>
<script src="${contextPath}/common/js/common/Tokanizer.js"></script>
<script src="${contextPath}/common/js/common/Evaluator.js"></script>
<script type="text/javascript">
	var rules = [
	             "P4=C4+D4+E4+F4+G4+H4+I4+J4+K4+L4+M4+N4","Q4=(C4+D4+E4+F4+G4+H4+I4+J4+K4+L4+M4+N4)/12",
	             "P5=C5+D5+E5+F5+G5+H5+I5+J5+K5+L5+M5+N5","Q5=(C5+D5+E5+F5+G5+H5+I5+J5+K5+L5+M5+N5)/12",
	             "C6=C4-C5","D6=D4-D5","E6=E4-E5","F6=F4-F5","G6=G4-G5","H6=H4-H5","I6=I4-I5","J6=J4-J5","K6=K4-K5","L6=L4-L5","M6=M4-M5","N6=N4-N5","O6=O4-O5",
	             "P6=C6+D6+E6+F6+G6+H6+I6+J6+K6+L6+M6+N6","Q6=(C6+D6+E6+F6+G6+H6+I6+J6+K6+L6+M6+N6)/12",
	             "C7=C8+C9+C10+C11+C12+C13+C14+C15+C16+C17+C18+C19+C20+C21++C22",
	             "D7=D8+D9+D10+D11+D12+D13+D14+D15+D16+D17+D18+D19+D20+D21++D22",
	             "E7=E8+E9+E10+E11+E12+E13+E14+E15+E16+E17+E18+E19+E20+E21++E22",
	             "F7=F8+F9+F10+F11+F12+F13+F14+F15+F16+F17+F18+F19+F20+F21++F22",
	             "G7=G8+G9+G10+G11+G12+G13+G14+G15+G16+G17+G18+G19+G20+G21++G22",
	             "H7=H8+H9+H10+H11+H12+H13+H14+H15+H16+H17+H18+H19+H20+H21++H22",
	             "I7=I8+I9+I10+I11+I12+I13+I14+I15+I16+I17+I18+I19+I20+I21++I22",
	             "J7=J8+J9+J10+J11+J12+J13+J14+J15+J16+J17+J18+J19+J20+J21++J22",
	             "K7=K8+K9+K10+K11+K12+K13+K14+K15+K16+K17+K18+K19+K20+K21++K22",
	             "L7=L8+L9+L10+L11+L12+L13+L14+L15+L16+L17+L18+L19+L20+L21++L22",
	             "M7=M8+M9+M10+M11+M12+M13+M14+M15+M16+M17+M18+M19+M20+M21++M22",
	             "N7=N8+N9+N10+N11+N12+N13+N14+N15+N16+N17+N18+N19+N20+N21++N22",
	             "O7=O8+O9+O10+O11+O12+O13+O14+O15+O16+O17+O18+O19+O20+O21++O22",
	             "P7=C7+D7+E7+F7+G7+H7+I7+J7+K7+L7+M7+N7","Q7=(C7+D7+E7+F7+G7+H7+I7+J7+K7+L7+M7+N7)/12",
	             "P8=C8+D8+E8+F8+G8+H8+I8+J8+K8+L8+M8+N8","Q8=(C8+D8+E8+F8+G8+H8+I8+J8+K8+L8+M8+N8)/12",
	             "P9=C9+D9+E9+F9+G9+H9+I9+J9+K9+L9+M9+N9","Q9=(C9+D9+E9+F9+G9+H9+I9+J9+K9+L9+M9+N9)/12",
	             "P10=C10+D10+E10+F10+G10+H10+I10+J10+K10+L10+M10+N10","Q10=(C10+D10+E10+F10+G10+H10+I10+J10+K10+L10+M10+N10)/12",
	             "P11=C11+D11+E11+F11+G11+H11+I11+J11+K11+L11+M11+N11","Q11=(C11+D11+E11+F11+G11+H11+I11+J11+K11+L11+M11+N11)/12",
	             "P12=C12+D12+E12+F12+G12+H12+I12+J12+K12+L12+M12+N12","Q12=(C12+D12+E12+F12+G12+H12+I12+J12+K12+L12+M12+N12)/12",
	             "P13=C13+D13+E13+F13+G13+H13+I13+J13+K13+L13+M13+N13","Q13=(C13+D13+E13+F13+G13+H13+I13+J13+K13+L13+M13+N13)/12",
	             "P14=C14+D14+E14+F14+G14+H14+I14+J14+K14+L14+M14+N14","Q14=(C14+D14+E14+F14+G14+H14+I14+J14+K14+L14+M14+N14)/12",
	             "P15=C15+D15+E15+F15+G15+H15+I15+J15+K15+L15+M15+N15","Q15=(C15+D15+E15+F15+G15+H15+I15+J15+K15+L15+M15+N15)/12",
	             "P16=C16+D16+E16+F16+G16+H16+I16+J16+K16+L16+M16+N16","Q16=(C16+D16+E16+F16+G16+H16+I16+J16+K16+L16+M16+N16)/12",
	             "P17=C17+D17+E17+F17+G17+H17+I17+J17+K17+L17+M17+N17","Q17=(C17+D17+E17+F17+G17+H17+I17+J17+K17+L17+M17+N17)/12",
	             "P18=C18+D18+E18+F18+G18+H18+I18+J18+K18+L18+M18+N18","Q18=(C18+D18+E18+F18+G18+H18+I18+J18+K18+L18+M18+N18)/12",
	             "P19=C19+D19+E19+F19+G19+H19+I19+J19+K19+L19+M19+N19","Q19=(C19+D19+E19+F19+G19+H19+I19+J19+K19+L19+M19+N19)/12",
	             "P20=C20+D20+E20+F20+G20+H20+I20+J20+K20+L20+M20+N20","Q20=(C20+D20+E20+F20+G20+H20+I20+J20+K20+L20+M20+N20)/12",
	             "P21=C21+D21+E21+F21+G21+H21+I21+J21+K21+L21+M21+N21","Q21=(C21+D21+E21+F21+G21+H21+I21+J21+K21+L21+M21+N21)/12",
	             "P22=C22+D22+E22+F22+G22+H22+I22+J22+K22+L22+M22+N22","Q22=(C22+D22+E22+F22+G22+H22+I22+J22+K22+L22+M22+N22)/12",
	             "P23=C23+D23+E23+F23+G23+H23+I23+J23+K23+L23+M23+N23","Q23=(C23+D23+E23+F23+G23+H23+I23+J23+K23+L23+M23+N23)/12",
	             
	             "C24=C6-C7-C23","D24=D6-D7-D23","E24=E6-E7-E23","F24=F6-F7-F23","G24=G6-G7-G23","H24=H6-H7-H23","I24=I6-I7-I23",
	             "J24=J6-J7-J23","K24=K6-K7-K23","L24=L6-L7-L23","M24=M6-M7-M23","N24=N6-N7-N23","O24=O6-O7-O23",
	             
	             "P24=C24+D24+E24+F24+G24+H24+I24+J24+K24+L24+M24+N24","Q24=(C24+D24+E24+F24+G24+H24+I24+J24+K24+L24+M24+N24)/12",
	             "P25=C25+D25+E25+F25+G25+H25+I25+J25+K25+L25+M25+N25","Q25=(C25+D25+E25+F25+G25+H25+I25+J25+K25+L25+M25+N25)/12",
	             "P26=C26+D26+E26+F26+G26+H26+I26+J26+K26+L26+M26+N26","Q26=(C26+D26+E26+F26+G26+H26+I26+J26+K26+L26+M26+N26)/12",
	             "P27=C27+D27+E27+F27+G27+H27+I27+J27+K27+L27+M27+N27","Q27=(C27+D27+E27+F27+G27+H27+I27+J27+K27+L27+M27+N27)/12",
	             "P28=C28+D28+E28+F28+G28+H28+I28+J28+K28+L28+M28+N28","Q28=(C28+D28+E28+F28+G28+H28+I28+J28+K28+L28+M28+N28)/12",
	             
	             "C29=C24-C25-C26-C27+C28","D29=D24-D25-D26-D27+D28","E29=E24-E25-E26-E27+E28","F29=F24-F25-F26-F27+F28",
	             "G29=G24-G25-G26-G27+G28","H29=H24-H25-H26-H27+H28","I29=I24-I25-I26-I27+I28","J29=J24-J25-J26-J27+J28",
	             "K29=K24-K25-K26-K27+K28","L29=L24-L25-L26-L27+L28","M29=M24-M25-M26-M27+M28","N29=N24-N25-N26-N27+N28","O29=O24-O25-O26-O27+O28",
	             
	             "P29=C29+D29+E29+F29+G29+H29+I29+J29+K29+L29+M29+N29","Q29=P29/12"
	            ]
	var exp = new Expression("");

	function Convert(strExp)
	{
	    if (strExp == null || strExp == undefined)
	    {
	        alert ("No expression is specified!");
	        return false;
	    }

	    exp.Expression(strExp);
	    return exp.Parse();
	}

	function Compute(strExp)
	{
	    exp.Expression(strExp);
	    var res = exp.Evaluate()+"";
	    if(res.indexOf(".")>=0){
	    	return new Number(parseFloat(res)).toFixed(2);
	    }
	    else{
	    	return res;
	    }
	}
</script>
<body class="whitebg">
  <div class="content_main">
    <div class="contentinner">
      <div class="place">
        <div class="title">客户维护信息>标准利润表</div>
      </div>
        <div class="tabplace">
            <ul class="com-tab" >
            <li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_jy.page?appId=${appId}&urlType=${urlType}">建议</a></li>
			<!-- <li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_jjbs.page?appId=${appId}&urlType=${urlType}">进件标识</a></li> -->
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_jbzk.page?appId=${appId}&urlType=${urlType}">基本状况</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_jyzt.page?appId=${appId}&urlType=${urlType}">经营状态</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_sczt.page?appId=${appId}&urlType=${urlType}">生存状态</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_ddpz.page?appId=${appId}&urlType=${urlType}">道德品质</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_fz.page?appId=${appId}&urlType=${urlType}">资产负债</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_lrjb.page?appId=${appId}&urlType=${urlType}">利润简表</a></li>
			<li class="tab activeTab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_bzlrb.page?appId=${appId}&urlType=${urlType}">标准利润</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_xjllb.page?appId=${appId}&urlType=${urlType}">现金流</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_jc.page?appId=${appId}&urlType=${urlType}">交叉</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_dhd.page?appId=${appId}&urlType=${urlType}">点货单</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_gdzc.page?appId=${appId}&urlType=${urlType}">固资</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_yfys.page?appId=${appId}&urlType=${urlType}">应付预收</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_ysyf.page?appId=${appId}&urlType=${urlType}">应收预付</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_lsfx.page?appId=${appId}&urlType=${urlType}">流水</a></li>
         </ul>
         </div>
      <form id="id_module_form">
         <div class="form-bd" id="formsId" style="margin-top: 0px;padding-top: 0px;">$!{tableContent}</div>
      </form>
      <div class="submit">
      #if(!$!lock)
      	<input type="button" class="current" id="id_count_button" value="计算" />
      	<input type="button" class="current" id="id_save_button" value="保存" />
      #end
      #if($!urlType==1)
        <input type="button" onclick="window.location.href='${contextPath}/intopieces/intopiecesquery/browse.page'" value="返回" />
      #else
      	<input type="button" onclick="window.location.href='${contextPath}/customer/customerInfor_wh_ty/browse.page'" value="返回" />
      #end
      </div>
    </div>
  </div>
  <script type="text/javascript">
	var layout = new FormsLayout("formsId");
	window.top.currentWindow.setLayout(layout);
	#set ($formName = "'#id_module_form'")
	#parse ("customer/customerInfor_wh_ty/customer_iframe_1_change_validation.js")
	
	$(document).ready(function() {		
		$("#id_save_button").click(function() {
			var b = new Base64(); 
			var content = {'content':b.encode($("#formsId").html())};
			var url = "${contextPath}/customer/customerInfor_wh_ty/change_report_bzlrb.json?appId=${appId}";
			$.ajax({
				 url : url,
				 type : "post",
				 data:content,
				 success : function(data) {
					 if (data.success) {
						 topWin.Dialog.message("保存成功！");
						 window.location.reload();
					 }
					 else{
						 topWin.Dialog.message(data.message);
					 }
				 }
			 });
        });
		
		//计算
		$("#id_count_button").click(function() {
			for(index in rules){
				var rule = rules[index];
				var sum_name = rule.split("=")[0];
				var strExp = rule.split("=")[1];
				//将编码换成数值
				var code = "";
				var sb = "";
				for(var i = 0;i<strExp.length;i++){
					if("^,*,/,%,+,-,(,)".indexOf(strExp[i])<0){
						code += strExp[i];
					}
					else{
						if(code != ""){
							var reg= /^[A-Za-z]+$/;
							if(reg.test(code[0])){
								if($("td[name='"+code+"']").html() == '&nbsp;')
								{
									sb += "0";
								}
								else{
									sb += $("td[name='"+code+"']").html();
								}
							}else{
								sb += code;
							}
							code = "";
						}
						sb += strExp[i];
					}
				}
				if(code != ""){
					var reg= /^[A-Za-z]+$/;
					if(reg.test(code[0])){
						if($("td[name='"+code+"']").html() == '&nbsp;')
						{
							sb += "0";
						}
						else{
							sb += $("td[name='"+code+"']").html();
						}
					}else{
						sb += code;
					}
					code = "";
				}
				$("td[name='"+sum_name+"']").html(Compute(sb));
				exp.Reset();
			}
		});
	});
  </script>
   <script src="${contextPath}/js/customerInfor/customer_infor.js"></script>
  
</body>
#parse ("common/iframe_page_footer.htm")
