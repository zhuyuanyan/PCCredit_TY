#parse ("common/iframe_page_header.htm")
#parse ("common/macro.htm")
<link rel="stylesheet" type="text/css" href="${uicasePath}/css/specialtab.css" />
<script src="${contextPath}/common/js/common/Date.js"></script>
<script src="${contextPath}/common/js/common/Stack.js"></script>
<script src="${contextPath}/common/js/common/Tokanizer.js"></script>
<script src="${contextPath}/common/js/common/Evaluator.js"></script>
<script type="text/javascript">
	var rules = [
             'C7=C5+C6','C12=C9+C10+C11','C13=C7-C12','C32=C15+C16+C17+C18+C19+C20+C21+C22+C23+C24+C25+C26+C27+C28+C29+C30+C31','C34=C13-C32-C33','C39=C34-C35-C36-C37+C38',
             'D7=D5+D6','D12=D9+D10+D11','D13=D7-D12','D32=D15+D16+D17+D18+D19+D20+D21+D22+D23+D24+D25+D26+D27+D28+D29+D30+D31','D34=D13-D32-D33','D39=D34-D35-D36-D37+D38',
             'E7=E5+E6','E12=E9+E10+E11','E13=E7-E12','E32=E15+E16+E17+E18+E19+E20+E21+E22+E23+E24+E25+E26+E27+E28+E29+E30+E31','E34=E13-E32-E33','E39=E34-E35-E36-E37+E38',
             'F7=F5+F6','F12=F9+F10+F11','F13=F7-F12','F32=F15+F16+F17+F18+F19+F20+F21+F22+F23+F24+F25+F26+F27+F28+F29+F30+F31','F34=F13-F32-F33','F39=F34-F35-F36-F37+F38',
             'G7=G5+G6','G12=G9+G10+G11','G13=G7-G12','G32=G15+G16+G17+G18+G19+G20+G21+G22+G23+G24+G25+G26+G27+G28+G29+G30+G31','G34=G13-G32-G33','G39=G34-G35-G36-G37+G38',
             'H7=H5+H6','H12=H9+H10+H11','H13=H7-H12','H32=H15+H16+H17+H18+H19+H20+H21+H22+H23+H24+H25+H26+H27+H28+H29+H30+H31','H34=H13-H32-H33','H39=H34-H35-H36-H37+H38',
             'I7=I5+I6','I12=I9+I10+I11','I13=I7-I12','I32=I15+I16+I17+I18+I19+I20+I21+I22+I23+I24+I25+I26+I27+I28+I29+I30+I31','I34=I13-I32-I33','I39=I34-I35-I36-I37+I38',
             'J7=J5+J6','J12=J9+J10+J11','J13=J7-J12','J32=J15+J16+J17+J18+J19+J20+J21+J22+J23+J24+J25+J26+J27+J28+J29+J30+J31','J34=J13-J32-J33','J39=J34-J35-J36-J37+J38',
             'K7=K5+K6','K12=K9+K10+K11','K13=K7-K12','K32=K15+K16+K17+K18+K19+K20+K21+K22+K23+K24+K25+K26+K27+K28+K29+K30+K31','K34=K13-K32-K33','K39=K34-K35-K36-K37+K38',
             'L7=L5+L6','L12=L9+L10+L11','L13=L7-L12','L32=L15+L16+L17+L18+L19+L20+L21+L22+L23+L24+L25+L26+L27+L28+L29+L30+L31','L34=L13-L32-L33','L39=L34-L35-L36-L37+L38',
             'M7=M5+M6','M12=M9+M10+M11','M13=M7-M12','M32=M15+M16+M17+M18+M19+M20+M21+M22+M23+M24+M25+M26+M27+M28+M29+M30+M31','M34=M13-M32-M33','M39=M34-M35-M36-M37+M38',
             'N7=N5+N6','N12=N9+N10+N11','N13=N7-N12','N32=N15+N16+N17+N18+N19+N20+N21+N22+N23+N24+N25+N26+N27+N28+N29+N30+N31','N34=N13-N32-N33','N39=N34-N35-N36-N37+N38',
             
             'O5=C5+D5+E5+F5+G5+H5+I5+J5+K5+L5+M5+N5',
             'O6=C6+D6+E6+F6+G6+H6+I6+J6+K6+L6+M6+N6',
             'O7=C7+D7+E7+F7+G7+H7+I7+J7+K7+L7+M7+N7',
             
             'O9=C9+D9+E9+F9+G9+H9+I9+J9+K9+L9+M9+N9',
             'O10=C10+D10+E10+F10+G10+H10+I10+J10+K10+L10+M10+N10',
             'O11=C11+D11+E11+F11+G11+H11+I11+J11+K11+L11+M11+N11',
             'O12=C12+D12+E12+F12+G12+H12+I12+J12+K12+L12+M12+N12',
             'O13=C13+D13+E13+F13+G13+H13+I13+J13+K13+L13+M13+N13',
             
             'O15=C15+D15+E15+F15+G15+H15+I15+J15+K15+L15+M15+N15',
             'O16=C16+D16+E16+F16+G16+H16+I16+J16+K16+L16+M16+N16',
             'O17=C17+D17+E17+F17+G17+H17+I17+J17+K17+L17+M17+N17',
             'O18=C18+D18+E18+F18+G18+H18+I18+J18+K18+L18+M18+N18',
             'O19=C19+D19+E19+F19+G19+H19+I19+J19+K19+L19+M19+N19',
             'O20=C20+D20+E20+F20+G20+H20+I20+J20+K20+L20+M20+N20',
             'O21=C21+D21+E21+F21+G21+H21+I21+J21+K21+L21+M21+N21',
             'O22=C22+D22+E22+F22+G22+H22+I22+J22+K22+L22+M22+N22',
             'O23=C23+D23+E23+F23+G23+H23+I23+J23+K23+L23+M23+N23',
             'O24=C24+D24+E24+F24+G24+H24+I24+J24+K24+L24+M24+N24',
             'O25=C25+D25+E25+F25+G25+H25+I25+J25+K25+L25+M25+N25',
             'O26=C26+D26+E26+F26+G26+H26+I26+J26+K26+L26+M26+N26',
             'O27=C27+D27+E27+F27+G27+H27+I27+J27+K27+L27+M27+N27',
             'O28=C28+D28+E28+F28+G28+H28+I28+J28+K28+L28+M28+N28',
             'O29=C29+D29+E29+F29+G29+H29+I29+J29+K29+L29+M29+N29',
             'O30=C30+D30+E30+F30+G30+H30+I30+J30+K30+L30+M30+N30',
             'O31=C31+D31+E31+F31+G31+H31+I31+J31+K31+L31+M31+N31',
             'O32=C32+D32+E32+F32+G32+H32+I32+J32+K32+L32+M32+N32',
             
             'O34=C34+D34+E34+F34+G34+H34+I34+J34+K34+L34+M34+N34',
             'O35=C35+D35+E35+F35+G35+H35+I35+J35+K35+L35+M35+N35',
             'O36=C36+D36+E36+F36+G36+H36+I36+J36+K36+L36+M36+N36',
             'O37=C37+D37+E37+F37+G37+H37+I37+J37+K37+L37+M37+N37',
             'O38=C38+D38+E38+F38+G38+H38+I38+J38+K38+L38+M38+N38',
             'O39=C39+D39+E39+F39+G39+H39+I39+J39+K39+L39+M39+N39',
             
             'P5=O5/12','P6=O6/12','P7=O7/12',
             'P9=O9/12','P10=O10/12','P11=O11/12','P12=O12/12','P13=O13/12',
             'P15=O15/12','P16=O16/12','P17=O17/12','P18=O18/12','P19=O19/12','P20=O20/12','P21=O21/12','P22=O22/12','P23=O23/12','P24=O24/12','P25=O25/12',
             'P26=O26/12','P27=O27/12','P28=O28/12','P29=O29/12','P30=O30/12','P31=O31/12','P32=O32/12',
             'P34=O34/12','P35=O35/12','P36=O36/12','P37=O37/12','P38=O38/12','P39=O39/12'
             
	            ]
	var exp = new Expression("");

	function Convert(strExp)
	{
	    if (strExp == null || strExp == undefined)
	    {
	        alert ("No expression is specified!");
	        return false;
	    }

	    exp.Expression(strExp);
	    return exp.Parse();
	}

	function Compute(strExp)
	{
	    exp.Expression(strExp);
	    var res = exp.Evaluate()+"";
	    if(res.indexOf(".")>=0){
	    	return new Number(parseFloat(res)).toFixed(2);
	    }
	    else{
	    	return res;
	    }
	}
</script>
<body class="whitebg">
  <div class="content_main">
    <div class="contentinner">
      <div class="place">
        <div class="title">客户维护信息>损益</div>
      </div>
        <div class="tabplace">
            <ul class="com-tab" >
            <li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_fz.page?appId=${appId}&urlType=${urlType}">资负</a></li>
			<li class="tab activeTab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_sy.page?appId=${appId}&urlType=${urlType}">损益</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_jl.page?appId=${appId}&urlType=${urlType}">金流</a></li>
			<li class="tab"><a href="${contextPath}/customer/customerInfor_wh_ty/report_jc.page?appId=${appId}&urlType=${urlType}">交叉</a></li>
         </ul>
         </div>
      <form id="id_module_form">
         <div class="form-bd" id="formsId" style="margin-top: 0px;padding-top: 0px;">$!{tableContent}</div>
      </form>
      <div class="submit">
      #if(!$!lock)
      	<input type="button" class="current" id="id_count_button" value="计算" />
      	<input type="button" class="current" id="id_save_button" value="保存" />
      #end
        #if($!urlType=='1')
        <input type="button" onclick="window.location.href='${contextPath}/intopieces/intopiecesquery/browse.page'" value="返回" />
      #else
      	<input type="button" onclick="window.location.href='${contextPath}/customer/customerInfor_wh_ty/browse.page'" value="返回" />
      #end
      </div>
    </div>
  </div>
  <script type="text/javascript">
	var layout = new FormsLayout("formsId");
	window.top.currentWindow.setLayout(layout);
	#set ($formName = "'#id_module_form'")
	#parse ("customer/customerInfor_wh_ty/customer_iframe_1_change_validation.js")
	
	$(document).ready(function() {		
		$("#id_save_button").click(function() {
			var b = new Base64(); 
			var content = {'content':b.encode($("#formsId").html())};
			var url = "${contextPath}/customer/customerInfor_wh_ty/change_report_sy.json?appId=${appId}";
			$.ajax({
				 url : url,
				 type : "post",
				 data:content,
				 success : function(data) {
					 if (data.success) {
						 topWin.Dialog.message("保存成功！");
						 window.location.reload();
					 }
					 else{
						 topWin.Dialog.message(data.message);
					 }
				 }
			 });
        });
		
		//计算
		$("#id_count_button").click(function() {
			for(index in rules){
				var rule = rules[index];
				var sum_name = rule.split("=")[0];
				var strExp = rule.split("=")[1];
				//将编码换成数值
				var code = "";
				var sb = "";
				for(var i = 0;i<strExp.length;i++){
					if("^,*,/,%,+,-,(,)".indexOf(strExp[i])<0){
						code += strExp[i];
					}
					else{
						if(code != ""){
							var reg= /^[A-Za-z]+$/;
							if(reg.test(code[0])){
								if($("td[name='"+code+"']").html() == '&nbsp;')
								{
									sb += "0";
								}
								else{
									sb += $("td[name='"+code+"']").html();
								}
							}else{
								sb += code;
							}
							code = "";
						}
						sb += strExp[i];
					}
				}
				if(code != ""){
					var reg= /^[A-Za-z]+$/;
					if(reg.test(code[0])){
						if($("td[name='"+code+"']").html() == '&nbsp;')
						{
							sb += "0";
						}
						else{
							sb += $("td[name='"+code+"']").html();
						}
					}else{
						sb += code;
					}
					code = "";
				}
				$("td[name='"+sum_name+"']").html(Compute(sb));
				exp.Reset();
			}
		});
	});
  </script>
   <script src="${contextPath}/js/customerInfor/customer_infor.js"></script>
  
</body>
#parse ("common/iframe_page_footer.htm")
